{{define "settings/panel/api"}}
<a-row :gutter="[16, 16]">
    <a-col :span="24">
        <a-card :title='{{ i18n "pages.settings.api.globalTitle"}}' :loading="apiStates.loading">
            <a-row :gutter="[12, 12]">
                <a-col :xs="24" :md="12">
                    <a-setting-list-item paddings="small">
                        <template #title>{{ i18n "pages.settings.api.tokenOnly" }}</template>
                        <template #description>{{ i18n "pages.settings.api.tokenOnlyDesc" }}</template>
                        <template #control>
                            <a-switch v-model="apiSettings.apiTokenOnly"></a-switch>
                        </template>
                    </a-setting-list-item>
                </a-col>
                <a-col :xs="24" :md="12">
                    <a-setting-list-item paddings="small">
                        <template #title>{{ i18n "pages.settings.api.defaultRate" }}</template>
                        <template #description>{{ i18n "pages.settings.api.defaultRateDesc" }}</template>
                        <template #control>
                            <a-input-number :min="0" :max="100000" v-model="apiSettings.apiDefaultRateLimit"
                                :style="{ width: '100%' }"></a-input-number>
                        </template>
                    </a-setting-list-item>
                </a-col>
            </a-row>
            <a-space>
                <a-button type="primary" @click="saveApiSettings" :loading="apiStates.saving">
                    {{ i18n "save" }}
                </a-button>
            </a-space>
        </a-card>
    </a-col>

    <a-col :span="24">
        <a-card :title='{{ i18n "pages.settings.api.usersTitle"}}' :loading="apiStates.loading">
            <a-row :gutter="[12, 12]" :style="{ marginBottom: '8px' }">
                <a-col :xs="24" :md="10">
                    <a-input v-model="apiUserForm.name" :placeholder='{{ i18n "pages.settings.api.userNamePlaceholder"}}'>
                        <template #prefix>
                            <a-icon type="user"></a-icon>
                        </template>
                    </a-input>
                </a-col>
                <a-col :xs="24" :md="8">
                    <a-input-number :style="{ width: '100%' }" :min="0" :max="100000" v-model="apiUserForm.rate"
                        :placeholder='{{ i18n "pages.settings.api.ratePlaceholder"}}'></a-input-number>
                </a-col>
                <a-col :xs="24" :md="6">
                    <a-button type="primary" block @click="createApiUser" :loading="apiStates.creating">
                        {{ i18n "pages.settings.api.createUser"}}
                    </a-button>
                </a-col>
            </a-row>

            <a-table :columns="apiTable.columns" :data-source="apiUsers" :pagination="false" size="middle"
                row-key="id">
                <template #status="{ record }">
                    <a-tag :color="record.enabled ? 'green' : 'volcano'">
                        [[ record.enabled ? "{{ i18n "enabled" }}" : "{{ i18n "disabled" }}" ]]
                    </a-tag>
                </template>
                <template #rate="{ record }">
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <a-input-number :min="0" :max="100000" size="small" v-model="record.rateLimitPerMinute"
                            @blur="updateApiRate(record)" :style="{ width: '100%' }"></a-input-number>
                    </div>
                </template>
                <template #lastUsed="{ record }">
                    [[ record.lastUsedAt ? record.lastUsedAt.replace('T', ' ').replace('Z','') : 'â€”' ]]
                </template>
                <template #actions="{ record }">
                    <a-space :size="8">
                        <a-button type="link" size="small"
                            @click="toggleApiUser(record, !record.enabled)">
                            [[ record.enabled ? "{{ i18n "pages.settings.api.disable" }}" : "{{ i18n "pages.settings.api.enable" }}" ]]
                        </a-button>
                        <a-button type="link" size="small" @click="rotateApiUser(record)">
                            {{ i18n "pages.settings.api.rotate" }}
                        </a-button>
                        <a-button type="link" size="small" @click="deleteApiUser(record)">
                            {{ i18n "delete" }}
                        </a-button>
                    </a-space>
                </template>
            </a-table>
        </a-card>
    </a-col>
</a-row>

<a-modal v-model="tokenModal.visible" :title='{{ i18n "pages.settings.api.tokenModalTitle"}}' footer="" :width="600">
    <p style="font-weight: 600; margin-bottom: 6px;">{{ i18n "pages.settings.api.tokenOnce" }}</p>
    <a-alert type="info" show-icon :message="tokenModal.token"></a-alert>
    <a-space :style="{ marginTop: '12px' }">
        <a-button type="primary" @click="copyToken">{{ i18n "copy" }}</a-button>
        <a-button @click="tokenModal.visible=false">{{ i18n "close" }}</a-button>
    </a-space>
</a-modal>
{{end}}
